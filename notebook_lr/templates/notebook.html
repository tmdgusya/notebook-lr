<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>notebook-lr</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

  <!-- CodeMirror 5 from CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/theme/monokai.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/python/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/mode/markdown/markdown.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/addon/edit/closebrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.18/addon/edit/matchbrackets.min.js"></script>

  <!-- marked.js for markdown rendering -->
  <script src="https://cdn.jsdelivr.net/npm/marked@15.0.7/marked.min.js"></script>

  <!-- DOMPurify for HTML/SVG sanitization -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.4/dist/purify.min.js"></script>

  <!-- KaTeX for LaTeX rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

  <!-- mermaid.js for diagram rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof mermaid !== 'undefined') {
        mermaid.initialize({ startOnLoad: false, theme: 'default', securityLevel: 'strict' });
      }
    });
  </script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/static/css/notebook.css">
</head>
<body>
  <div id="notebook-app">
    <header id="notebook-header">
      <div class="header-left">
        <h1>notebook-lr</h1>
        <span id="save-indicator" class="save-indicator save-saved" title="All changes saved">
          <span class="save-icon">&#10003;</span> <span class="save-text">Saved</span>
        </span>
      </div>
      <div id="notebook-info"></div>
    </header>

    <div id="toolbar">
      <button id="run-all-btn" class="toolbar-btn toolbar-btn-primary" title="Run All Cells (Ctrl+Shift+Enter)">
        <span class="icon">&#9654;&#9654;</span> <span class="btn-label">Run All</span>
      </button>
      <div class="toolbar-separator"></div>
      <button id="add-code-btn" class="toolbar-btn" title="Add Code Cell (A)">
        <span class="icon">&#9998;</span> <span class="btn-label">Code</span>
      </button>
      <button id="add-md-btn" class="toolbar-btn" title="Add Markdown Cell (M)">
        <span class="icon">&#128221;</span> <span class="btn-label">Markdown</span>
      </button>
      <div class="toolbar-separator"></div>
      <button id="save-btn" class="toolbar-btn" title="Save (Ctrl+S)">
        <span class="icon">&#128190;</span> <span class="btn-label">Save</span>
      </button>
      <button id="save-session-btn" class="toolbar-btn" title="Save with Session (Ctrl+Shift+S)">
        <span class="icon">&#128190;</span> <span class="btn-label">Save + Session</span>
      </button>
      <button id="load-btn" class="toolbar-btn" title="Load Notebook">
        <span class="icon">&#128194;</span> <span class="btn-label">Load</span>
      </button>
      <input type="file" id="load-file-input" accept=".nblr" hidden>
      <div class="toolbar-separator"></div>
      <button id="vars-btn" class="toolbar-btn" title="Show Variables">
        <span class="icon">&#123;</span> <span class="btn-label">Variables</span>
      </button>
      <button id="clear-vars-btn" class="toolbar-btn toolbar-btn-danger" title="Clear All Variables">
        <span class="icon">&#128465;</span> <span class="btn-label">Clear</span>
      </button>
      <div class="toolbar-spacer"></div>
      <button id="help-btn" class="toolbar-btn" title="Keyboard Shortcuts (?)" style="margin-left: auto;">
        <span class="icon">&#63;</span> <span class="btn-label">Help</span>
      </button>
    </div>

    <div id="cells-container">
      <!-- Cells and add-cell dividers rendered dynamically by cells.js -->
    </div>

    <div id="variables-panel" class="panel hidden">
      <div class="panel-header">
        <h3>Variables</h3>
        <button id="close-vars-btn" class="close-btn">&times;</button>
      </div>
      <div id="variables-content"></div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcuts-modal" class="modal hidden">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>Keyboard Shortcuts</h3>
          <button id="close-shortcuts-btn" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="shortcuts-grid">
            <div class="shortcut-section">
              <h4>Navigation</h4>
              <div class="shortcut-item"><kbd>↑</kbd><kbd>↓</kbd> Navigate cells</div>
              <div class="shortcut-item"><kbd>Enter</kbd> Edit cell</div>
              <div class="shortcut-item"><kbd>Esc</kbd> Exit edit mode</div>
            </div>
            <div class="shortcut-section">
              <h4>Execution</h4>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Enter</kbd> Run cell</div>
              <div class="shortcut-item"><kbd>Shift</kbd>+<kbd>Enter</kbd> Run and advance</div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>Enter</kbd> Run all</div>
            </div>
            <div class="shortcut-section">
              <h4>Cell Management</h4>
              <div class="shortcut-item"><kbd>A</kbd> Add code cell</div>
              <div class="shortcut-item"><kbd>M</kbd> Add markdown cell</div>
              <div class="shortcut-item"><kbd>D</kbd> Delete selected cell</div>
            </div>
            <div class="shortcut-section">
              <h4>File Operations</h4>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>S</kbd> Save</div>
              <div class="shortcut-item"><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>S</kbd> Save with session</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS modules loaded in dependency order -->
  <script src="/static/js/api.js"></script>
  <script src="/static/js/editor.js"></script>
  <script src="/static/js/cells.js"></script>
  <script src="/static/js/comments.js"></script>
  <script src="/static/js/execution.js"></script>
  <script src="/static/js/toolbar.js"></script>
  <script src="/static/js/fileops.js"></script>
  <script src="/static/js/app.js"></script>
</body>
</html>
